
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Quickstart with SWYFT &#8212; swyft 0.1 documentation</title>
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/language_data.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <div class="section" id="quickstart-with-swyft">
<h1>Quickstart with SWYFT<a class="headerlink" href="#quickstart-with-swyft" title="Permalink to this headline">¶</a></h1>
<div class="section" id="quickstart-example">
<h2>Quickstart example<a class="headerlink" href="#quickstart-example" title="Permalink to this headline">¶</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">model</span><span class="p">(</span><span class="n">z</span><span class="p">):</span>
</pre></div>
</div>
</div>
<div class="section" id="general-philosophy">
<h2>General philosophy<a class="headerlink" href="#general-philosophy" title="Permalink to this headline">¶</a></h2>
<p><em>swyft</em> implements algorithms for (a) nested neural likelihood-to-evidence ratio estimation and (b) simulation reuse via an inhomogeneous Poisson point process cache of parameters and corresponding simulations. Together, these algorithms enable automatic and extremely simulator efficient estimation of marginal and joint posteriors.  Simulator runs are never rejected and can be automatically reused in future analysis, enabling efficient initial runs and hyper-efficient follow-up studies.</p>
</div>
<div class="section" id="general-usage">
<h2>General usage<a class="headerlink" href="#general-usage" title="Permalink to this headline">¶</a></h2>
<p>SWYFT is simple to use.  First, we define a model function which takes an
argument numpy vector <span class="math notranslate nohighlight">\(z\)</span> and returns simulated data <span class="math notranslate nohighlight">\(x\)</span>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">model</span><span class="p">(</span><span class="n">z</span><span class="p">):</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">fancy_simulator</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
    <span class="n">n</span> <span class="o">=</span> <span class="n">noise</span><span class="p">()</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">m</span> <span class="o">+</span> <span class="n">n</span>
    <span class="k">return</span> <span class="n">x</span>
</pre></div>
</div>
<p>We then use the model to generate mock observational data.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">z0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">])</span>
<span class="n">x0</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="n">z0</span><span class="p">)</span>
</pre></div>
</div>
<p>The analysis is then started by invoking SWYFT as follows.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">swyft</span> <span class="kn">import</span> <span class="n">SWYFT</span>

<span class="n">sw</span> <span class="o">=</span> <span class="n">SWYFT</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">zdim</span> <span class="o">=</span> <span class="mi">3</span><span class="p">)</span>
<span class="n">sw</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">nrounds</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="n">nsamples</span> <span class="o">=</span> <span class="mi">5000</span><span class="p">)</span>
</pre></div>
</div>
<p>This will call the simulator <cite>model</cite> around 15000 times, and sequentially zoom
into the parameter range that is consistent with mock data $x0$.  After
training, the 1-dim marginal posteriors can be plot using</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pylab</span> <span class="kn">import</span> <span class="n">plot</span><span class="p">,</span> <span class="n">show</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">zdim</span><span class="p">):</span>
    <span class="n">z</span><span class="p">,</span> <span class="n">p</span> <span class="o">=</span> <span class="n">sw</span><span class="o">.</span><span class="n">posterior</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
    <span class="n">plot</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="n">i</span><span class="p">)</span>
    <span class="n">axvline</span><span class="p">(</span><span class="n">z0</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>  <span class="c1"># Comparison with true value</span>
<span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<p>If, e.g., 2-dim posteriors for some of the parameter pairs are desired, they
can be generated simply as well.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">SWYFT</span><span class="o">.</span><span class="n">comb</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]])</span>
<span class="n">z</span><span class="p">,</span> <span class="n">p</span> <span class="o">=</span> <span class="n">SWYFT</span><span class="o">.</span><span class="n">posterior</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="section" id="ip3-data-caching">
<h2>iP3 Data Caching<a class="headerlink" href="#ip3-data-caching" title="Permalink to this headline">¶</a></h2>
<p>(IN PROGRESS)</p>
<p>Simulator runs can be automatically re-used.  This is done by specifying the
cache when invoking <cite>SWYFT</cite></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">swyft</span> <span class="kn">import</span> <span class="n">MemoryCache</span><span class="p">,</span> <span class="n">DirectoryCache</span>

<span class="n">ds</span> <span class="o">=</span> <span class="n">DirectoryCache</span><span class="p">(</span><span class="n">filename</span> <span class="o">=</span> <span class="s1">&#39;ds.hdf5&#39;</span><span class="p">)</span>

<span class="n">sw</span> <span class="o">=</span> <span class="n">SWYFT</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">zdim</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="n">ds</span> <span class="o">=</span> <span class="n">ds</span><span class="p">)</span>
<span class="n">sw</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">nrounds</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="n">nsamples</span> <span class="o">=</span> <span class="mi">5000</span><span class="p">)</span>
</pre></div>
</div>
<p>This works just as above.  However, if we perform a similar analysis again
(with the same or other mock data), the number of simulator calls is, sometimes
greatly, reduced.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Rerunning does require less sampler runs</span>
<span class="n">sw</span> <span class="o">=</span> <span class="n">SWYFT</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span> <span class="n">zdim</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="n">ds</span> <span class="o">=</span> <span class="n">ds</span><span class="p">)</span>
<span class="n">sw</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">nrounds</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="n">nsamples</span> <span class="o">=</span> <span class="mi">5000</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="custom-head-networks">
<h2>Custom head networks<a class="headerlink" href="#custom-head-networks" title="Permalink to this headline">¶</a></h2>
<p>(IN PROGRESS)</p>
<p>Input data is assumed to be vector-like.  Usually, vectors up to few hundred
values work well out-of-the-box.  For larger sets of data (images, volumetric
data, in general diverse data from various experiments), pre-processing is
required.  This is done using a <cite>Head</cite> network.  SWYFT comes with a range of
Head networks for typical use-cases, but those networks can be also custom made
and user-defined.  For image analysis problems, a simple convolutional neural network can be used. Invoking SWYFT with the head-network is shown below.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">swyft</span> <span class="kn">import</span> <span class="n">CNN</span>

<span class="n">sw</span> <span class="o">=</span> <span class="n">SWYFT</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">zdim</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="n">head</span> <span class="o">=</span> <span class="n">CNN</span><span class="p">)</span>
<span class="n">sw</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">nrounds</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="n">nsamples</span> <span class="o">=</span> <span class="mi">5000</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">swyft</a></h1>








<h3>Navigation</h3>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2020, AC,BM,CW.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 3.3.0</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../_sources/.ipynb_checkpoints/quickstart-checkpoint.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>